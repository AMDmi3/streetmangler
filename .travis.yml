sudo: false
language: cpp
compiler:
  - gcc
  - clang
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - cmake
    - g++-4.8
    - libicu-dev
    - libexpat1-dev
before_install:
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8" CC="gcc-4.8"; fi
script:
  - cmake -DCMAKE_CXX_FLAGS="-Werror" .
  - make && make test
  - env LC_ALL=ru_RU.UTF-8 scripts/dbmaint.sh
  - git diff --exit-code; echo $?; true
  - "if ! git diff --exit-code; then echo 'FATAL: run scripts/dbmaint.sh and commit changes'; false; fi"
